" ===
" === Base
" ===
set nu
set rnu
set showmode
set showcmd
set hlsearch
set incsearch
set ignorecase
set smartcase
set scrolloff=5
set timeoutlen=500
" 系统剪切板
set clipboard^=unnamed,unnamedplus
" 中英文输入法自动切换
"set keep-english-in-normal

" ===
" === Plugins
" ===
set highlightedyank
set ideajoin
set multiple-cursors

" 仿真NERDTree插件
" https://github.com/JetBrains/ideavim/wiki/NERDTree-support
set NERDTree
nnoremap <leader>e :NERDTreeToggle<CR>
nnoremap <leader>o :NERDTreeFind<CR>

" https://github.com/JetBrains/ideavim/blob/master/doc/IdeaVim%20Plugins.md
Plug 'vim-scripts/ReplaceWithRegister'
nnoremap rs  <Plug>ReplaceWithRegisterOperator
nnoremap rss <Plug>ReplaceWithRegisterLine
xnoremap rs  <Plug>ReplaceWithRegisterVisual

set easymotion
noremap \ <Plug>(easymotion-prefix)
noremap s <Plug>(easymotion-prefix)f
noremap S <Plug>(easymotion-prefix)F

"set sneak
set surround
"set which-key

" ===
" === Mappings
" ===
" Map <space> to leader
let mapleader=" "
inoremap jj <Esc>
noremap gs ^
noremap gh 0
noremap gl $
nnoremap <Esc> :noh<CR>

" 拖拽行
"nnoremap <C-S-j> :move +1<CR>==
"nnoremap <C-S-k> :move -2<CR>==
"xnoremap <C-S-j> :move '>+1<CR>gv=gv
"xnoremap <C-S-k> :move '<-2<CR>gv=gv

" x模式黏贴后重新复制被黏贴内容
"xnoremap p pgvy

" 复制整个缓冲区
nnoremap <leader>y mmggVGy`m

" https://github.com/JetBrains/ideavim
" IdeaVim: track action Ids
" run
nnoremap <leader><CR> <action>(Run)
" 搜索
"nnoremap / <action>(Find)
nnoremap ? <action>(Find)
nnoremap <C-o> <Action>(Back)
nnoremap <C-i> <Action>(Forward)
"nnoremap u <Action>($Undo)
nnoremap U <Action>($Redo)
" 查找
nnoremap <leader><leader> <Action>(SearchEverywhere)
" 文件查找
nnoremap <leader>ff <Action>(GotoFile)
" 全局模糊搜索
nnoremap <leader>fg <Action>(FindInPath)
" 全局替换
nnoremap <leader>fr <Action>(ReplaceInPath)
" 类查找
nnoremap gw <Action>(GotoClass)
" 类方法或类成员字段查找
nnoremap gS <Action>(FileStructurePopup)
" 实现类或方法查找
nnoremap gI <Action>(GotoImplementation)
" 跳转到定义或引用处
nnoremap gd <Action>(GotoDeclaration)
" 查找所有引用，类似vim中的quickfix列表
nnoremap gr <Action>(FindUsages)
" 找到被实现的类或方法
nnoremap gp <Action>(GotoSuperMethod)
" 注释
xnoremap gc <Action>(CommentByLineComment)<Esc>
" 代码编辑提示
nnoremap <leader>a <Action>(ShowIntentionActions)
xnoremap <leader>a <Action>(ShowIntentionActions)
" 新建类
nnoremap <leader>nc <Action>(NewClass)
" 打开终端
nnoremap <leader>ft <Action>(ActivateTerminalToolWindow)
" 翻译
xnoremap <leader>t <Action>($EditorTranslateAction)<Esc>
nnoremap <leader>T <Action>($ShowTranslationDialogAction)
nnoremap <leader>t viw<Action>($EditorTranslateAction)
" 重命名
nnoremap <leader>r <Action>(RenameElement)
" 类wildfire
nnoremap <Enter> <Action>(EditorSelectWord)
nnoremap <BS> <Action>(EditorUnSelectWord)
xnoremap <Enter> <Action>(EditorSelectWord)
xnoremap <BS> <Action>(EditorUnSelectWord)
" 找到上一个或下一个问题
nnoremap [d <Action>(GotoPreviousError)
nnoremap ]d <Action>(GotoNextError)
" 找到上一个或下一个突出高亮
nnoremap [h <Action>(GotoPrevElementUnderCaretUsage)
nnoremap ]h <Action>(GotoNextElementUnderCaretUsage)
" vim模式开关
nnoremap <leader>vim <Action>(VimPluginToggle)
" 选择idea keymap
nnoremap <leader>mp <Action>(ChangeKeymap)
" 跳转tab
nnoremap [b <Action>(PreviousTab)
nnoremap ]b <Action>(NextTab)
" 跳转method
nnoremap [f <Action>(MethodUp)
nnoremap ]f <Action>(MethodDown)
" debug
nnoremap <leader>dd <Action>(DebugClass)
nnoremap <leader>db <Action>(ToggleLineBreakpoint)
nnoremap <leader>dr <Action>(EvaluateExpression)
" git
nnoremap <leader>gb <Action>(Annotate)

" ===
" === Shortcut handler
" ===
sethandler <C-2> a:ide
sethandler <C-S-2> a:ide
sethandler <C-6> a:ide
sethandler <C-S-6> a:ide
sethandler <C-A> a:ide
sethandler <C-B> i:ide n-v:vim
sethandler <C-C> i:ide n-v:vim
sethandler <C-D> i:ide n-v:vim
sethandler <C-E> a:ide
sethandler <C-F> i:ide n-v:vim
sethandler <C-G> a:ide
sethandler <C-H> a:ide
sethandler <C-I> i:ide n-v:vim
sethandler <C-J> a:ide
sethandler <C-K> a:ide
sethandler <C-L> a:ide
sethandler <C-M> a:ide
sethandler <C-N> a:ide
sethandler <C-O> i:ide n-v:vim
sethandler <C-P> a:ide
sethandler <C-Q> a:ide
sethandler <C-R> a:ide
sethandler <C-S> a:ide
sethandler <C-T> a:ide
sethandler <C-U> i:ide n-v:vim
sethandler <C-V> i:ide n-v:vim
sethandler <C-W> i:ide n-v:vim
sethandler <C-X> a:ide
sethandler <C-Y> a:ide
sethandler <C-[> a:ide
sethandler <C-\> a:ide
sethandler <C-]> a:ide
